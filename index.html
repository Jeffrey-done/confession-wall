const GITHUB_TOKEN = "your_github_token"; // 从环境变量中获取
const REPO_OWNER = "your_github_username"; // GitHub 用户名
const REPO_NAME = "confession-wall"; // 仓库名

async function handleRequest(request) {
    const { message, name } = await request.json();

    const content = Buffer.from(`Message: ${message}\nName: ${name || '匿名'}\n`).toString('base64');
    const filename = `message_${Date.now()}.txt`;

    const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filename}`, {
        method: 'PUT',
        headers: {
            Authorization: `Bearer ${GITHUB_TOKEN}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            message: `Add new message from ${name || '匿名'}`,
            content: content
        })
    });

    if (response.ok) {
        return new Response('Message uploaded successfully', { status: 200 });
    } else {
        return new Response('Failed to upload message', { status: 500 });
    }
}

addEventListener('fetch', event => {
    event.respondWith(handleRequest(event.request));
});
